package org.idp.wallet.verifiable_credentials_library

import android.content.Context
import androidx.test.core.app.ApplicationProvider
import kotlinx.coroutines.runBlocking
import org.json.JSONArray
import org.junit.Assert
import org.junit.Before
import org.junit.Test
import org.junit.runner.RunWith
import org.robolectric.RobolectricTestRunner

@RunWith(RobolectricTestRunner::class)
class VerifiablePresentationServiceTest {

    private lateinit var context: Context
    private lateinit var service: VerifiablePresentationService

    @Before
    fun setup() {
        context = ApplicationProvider.getApplicationContext()
        service = VerifiablePresentationService(context)
    }

    @Test
    fun testSaveAndFind() {
        runBlocking {
            val url = "openid4vp://?request=eyJ0eXBlIjoiSldUIiwiYWxnIjoiRVMyNTYifQ.eyJyZXNwb25zZV90eXBlIjoidnBfdG9rZW4iLCJwcmVzZW50YXRpb25fZGVmaW5pdGlvbiI6eyJpZCI6ImV4YW1wbGUgd2l0aCBzZWxlY3RpdmUgZGlzY2xvc3VyZSIsImlucHV0X2Rlc2NyaXB0b3JzIjpbeyJpZCI6IklEIGNhcmQgd2l0aCBjb25zdHJhaW50cyIsImZvcm1hdCI6eyJsZHBfdmMiOnsicHJvb2ZfdHlwZSI6WyJFZDI1NTE5U2lnbmF0dXJlMjAxOCJdfX0sImNvbnN0cmFpbnRzIjp7ImxpbWl0X2Rpc2Nsb3N1cmUiOiJyZXF1aXJlZCIsImZpZWxkcyI6W3sicGF0aCI6WyIkLnR5cGUiXSwiZmlsdGVyIjp7InR5cGUiOiJzdHJpbmciLCJwYXR0ZXJuIjoiSURDYXJkQ3JlZGVudGlhbCJ9fSx7InBhdGgiOlsiJC5jcmVkZW50aWFsU3ViamVjdC5naXZlbl9uYW1lIl19LHsicGF0aCI6WyIkLmNyZWRlbnRpYWxTdWJqZWN0LmZhbWlseV9uYW1lIl19LHsicGF0aCI6WyIkLmNyZWRlbnRpYWxTdWJqZWN0LmJpcnRoZGF0ZSJdfV19fV19LCJyZWRpcmVjdF91cmkiOiJodHRwczovL2NsaWVudC5leGFtcGxlLm9yZy9jYWxsYmFjayIsImNsaWVudF9tZXRhZGF0YSI6eyJpc3N1ZXIiOiJodHRwOi8vbG9jYWxob3N0OjgwODAvMTIzIiwiY2xpZW50X2lkIjoicHJpdmF0ZUtleUp3dCIsImNsaWVudF9zZWNyZXQiOiJwcml2YXRlS2V5Snd0U2VjcmV0IiwiY2xpZW50X2lkX2lzc3VlZF9hdCI6Mjg5MzI1NjgwMCwiY2xpZW50X3NlY3JldF9leHBpcmVzX2F0IjoyODkzMjc2ODAwLCJyZWRpcmVjdF91cmlzIjpbImh0dHBzOi8vY2xpZW50LmV4YW1wbGUub3JnL2NhbGxiYWNrIiwiaHR0cHM6Ly9jbGllbnQuZXhhbXBsZS5vcmcvY2FsbGJhY2syIiwiaHR0cDovL2xvY2FsaG9zdDo4MDgxL2NhbGxiYWNrIiwiaHR0cHM6Ly93d3cuY2VydGlmaWNhdGlvbi5vcGVuaWQubmV0L3Rlc3QvYS9pZHBfb2lkY19iYXNpYy9jYWxsYmFjayIsImh0dHBzOi8vbG9jYWxob3N0LmVtb2JpeC5jby51azo4NDQzL3Rlc3QvYS9pZHBfb2lkY19iYXNpYy9jYWxsYmFjayIsImh0dHBzOi8vbG9jYWxob3N0LmVtb2JpeC5jby51azo4NDQzL3Rlc3QvYS9pZHBfb2lkY19pbXBsaWNpdC9jYWxsYmFjayIsImh0dHBzOi8vbG9jYWxob3N0LmVtb2JpeC5jby51azo4NDQzL3Rlc3QvYS9pZHBfb2lkY19oeWJyaWQvY2FsbGJhY2siXSwicmVzcG9uc2VfdHlwZXMiOlsiY29kZSIsInRva2VuIiwiaWRfdG9rZW4iLCJjb2RlIHRva2VuIiwiY29kZSB0b2tlbiBpZF90b2tlbiIsInRva2VuIGlkX3Rva2VuIiwiY29kZSBpZF90b2tlbiIsIm5vbmUiLCJ2cF90b2tlbiIsInZwX3Rva2VuIGlkX3Rva2VuIl0sImdyYW50X3R5cGVzIjpbImF1dGhvcml6YXRpb25fY29kZSIsInJlZnJlc2hfdG9rZW4iLCJwYXNzd29yZCIsImNsaWVudF9jcmVkZW50aWFscyJdLCJzY29wZSI6Im9wZW5pZCBwcm9maWxlIGVtYWlsIGFkZHJlc3MgcGhvbmUgb2ZmbGluZV9hY2Nlc3MgYWNjb3VudCB0cmFuc2ZlcnMgcmVhZCB3cml0ZSIsImNsaWVudF9uYW1lIjoiTXkgRXhhbXBsZSBDbGllbnQiLCJjbGllbnRfbmFtZSNqYS1KcGFuLUpQIjoi44Kv44Op44Kk44Ki44Oz44OI5ZCNIiwidG9rZW5fZW5kcG9pbnRfYXV0aF9tZXRob2QiOiJwcml2YXRlX2tleV9qd3QiLCJsb2dvX3VyaSI6Imh0dHBzOi8vY2xpZW50LmV4YW1wbGUub3JnL2xvZ28ucG5nIiwiandrc191cmkiOiJodHRwczovL2NsaWVudC5leGFtcGxlLm9yZy9teV9wdWJsaWNfa2V5cy5qd2tzIiwiYXBwbGljYXRpb25fdHlwZSI6IndlYiIsImp3a3MiOiJ7XG4gICAgXCJrZXlzXCI6IFtcbiAgICAgICAge1xuICAgICAgICAgICAgXCJrdHlcIjogXCJSU0FcIixcbiAgICAgICAgICAgIFwiZVwiOiBcIkFRQUJcIixcbiAgICAgICAgICAgIFwidXNlXCI6IFwic2lnXCIsXG4gICAgICAgICAgICBcImtpZFwiOiBcImNsaWVudF9zZWNyZXRfa2V5XCIsXG4gICAgICAgICAgICBcImFsZ1wiOiBcIlJTMjU2XCIsXG4gICAgICAgICAgICBcIm5cIjogXCJzRlNxc1d1MmtvVTY5b0c2N0w1d3NWR3d6a3llODBCZDlsbU9maVNrU1RYeWM4SUtsNGd3bWo5dGp6eHhBMXBHWWk0U0tFUWFCWU5sOEpyR2h0dEJjYnRyYXF3YVM1UTZqcEcyNEMxejlualV1bUpXSm5lQTNFSjlMcHVuOWQzdUNBM2JfNzFYbks1UHItVnR3enBVNno4VkdOTVpobDhyWjVwMUwwc3lNcFowM3k1dFNXVk1udGNlaXFOYUZ1SkNGWEdNVlNscDZ2clZDcXBjTTRyMDM1dFVSLVB3alN5bnB4ZTdPR2xRcEhWU3ZCQ2JYSkp1ZmkwUXhJSWpkUHgya2E1ODZUbHZGalZ1MFFCRWNFb25fQk1yUERXUEQxYWFBRWNTUE05VTdmV3psSzZidEo4ZDM3VFhaMF9yUlBRX3RWZVpBbERuUmNsZWhIa0tmbGtOandcIlxuICAgICAgICB9LHtcbiAgICBcImt0eVwiOiBcIlJTQVwiLFxuICAgIFwiZVwiOiBcIkFRQUJcIixcbiAgICBcInVzZVwiOiBcInNpZ1wiLFxuICAgIFwia2lkXCI6IFwiY2xpZW50X3NlY3JldF9rZXlfMjA0MFwiLFxuICAgIFwiYWxnXCI6IFwiUlMyNTZcIixcbiAgICBcIm5cIjogXCJ0bmRJUGlZblR3OFVsYnZVNEdTRDc3dFB3ZVBOcHUxVlltVFdtck9BMWV0dk5WN3hlVTEwbEhQc2NtYnI3MDJiYm81YWRFVndXc3F3SGtTMGx2dEJCZXBiM0JLaEZ3bDg0X0ZmcXAtUF9ycWxkdVEzWG5yaTVCZmVzcmVPeTZuWlFjUTk1T1NSME00SFlnZmhyc01YQ3hRc0ExR0NEQ0k3b2lLbTQzaWNUeGFQb0gyMzJxZkpGR19ySW5IQkVva08tQkNLXzBDdC10bzZkeVJMeGxEZ0NvS1I0TG5XSl9FVGZ4emI5TFNkcDZtTzNjY0Q5cjlRaXQ3dGdidi12QnpHdE1XOVlkX2l3YkhNbzJxUlJNbmJRTUhISzNWaXAyeENFSWkxdjNIQy0tVVVYdWVjSl9TWUcyRDY5VUtDM2h2TzU0bGpXS3NJeWVHQWtjVHlEWkVSXCJcbn0gICAgXVxufSIsImF1dGhvcml6YXRpb25fZGV0YWlsc190eXBlcyI6WyJwYXltZW50X2luaXRpYXRpb24iLCJhY2NvdW50X2luZm9ybWF0aW9uIiwib3BlbmlkX2NyZWRlbnRpYWwiXX19.KvGKuN_aQ7bRjgwrJR__EdgVXFw04FMZVL8dQNMdYeP-lcE5popnOwqEoAZJIjwhQBrB7suvETdyfFl5nk2G8A"
            service.handleVpRequest(url)
        }
    }
}